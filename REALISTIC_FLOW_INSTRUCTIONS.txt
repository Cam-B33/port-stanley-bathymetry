# MAKING PARTICLES FOLLOW REAL BATHYMETRY

You're right - the current version just moves particles in straight lines. Let's make them actually follow the bathymetry gradients (shallow → deep)!

## Step 1: Generate Flow Data from Your Bathymetry

Run this command to extract flow vectors from your GeoTIFF:

```bash
cd /home/cameron/Dropbox/Port_Stanley_Bathymetry_2

python generate_flow_data.py \
    --bathymetry port_bathymetry_CLI/output/port_stanley_sept_30_2024_clipped.tif \
    --output-dir website-package/maps \
    --downsample 10
```

This will create two files in `website-package/maps/`:
- **`flow_vectors.json`** - Pre-calculated flow directions at grid points
- **`depth_grid.json`** - Downsampled bathymetry grid for the browser

## Step 2: Install Required Python Package

You might need pyproj:

```bash
pip install pyproj --break-system-packages
```

## Step 3: Update Your Website

I'll create an updated `index.html` that:
1. Loads the `depth_grid.json` file
2. Looks up flow direction for each particle's location
3. Makes particles follow the actual bathymetry gradients

The particles will:
- Flow from **shallow (sandbars) → deep (channels)**
- Speed up in steeper areas
- Follow the natural rip current paths
- Be influenced by your selected current direction (east/west/offshore)

## What the Math Does

The script calculates:
```
∇depth = gradient of bathymetry
flow_direction = normalize(∇depth)
```

Water naturally flows downhill (shallow to deep), so particles follow the gradient. When you select "East Current", it adds an eastward bias. "Offshore" adds a perpendicular (southward) bias.

## Step 4: Push Updated Files

```bash
cd website-package
git add maps/flow_vectors.json maps/depth_grid.json index.html
git commit -m "Add bathymetry-driven flow calculations"
git push
```

## Result

Particles will now:
✓ Flow along the deep channels you see in your bathymetry
✓ Avoid the shallow sandbars
✓ Show realistic rip current paths
✓ Match what you observe on the beach

Way cooler than straight-line flow!

---

**Want me to generate the updated HTML now that loads and uses this data?**
